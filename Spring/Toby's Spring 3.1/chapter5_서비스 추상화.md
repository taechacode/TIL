# 5장 서비스 추상화

## 5.1 사용자 레벨 관리 기능 추가
- UserDao는 User 오브젝트에 담겨 있는 사용자 정보는 CRUD만 하고 비즈니스 로직은 갖고 있지 않다.
- 여기에 간단한 비즈니스 로직을 추가해보자.
  - 사용자의 레벨은 BASIC, SILVER, GOLD 세 가지 중 하나다.
  - 사용자가 처음 가입하면 BASIC 레벨이 되며, 이후 활동에 따라서 한 단계씩 업그레이드될 수 있다.
  - 가입 후 50회 이상 로그인을 하면 BASIC에서 SILVER 레벨이 된다.
  - SILVER 레벨이면서 30번 이상 추천을 받으면 GOLD 레벨이 된다.
  - 사용자 레벨의 변경 작업은 일정한 주기를 가지고 일괄적으로 진행된다. 변경 작업 전에는 조건을 충족하더라도 레벨의 변경이 일어나지 않는다.

### 5.1.1 필드 추가
#### Level 이늄
#### User 필드 추가
#### UserDaoTest 테스트 수정
#### UserDaoJdbc 수정
<br/>

### 5.1.2 사용자 수정 기능 추가
#### 수정 기능 테스트 추가
#### UserDao와 UserDaoJdbc 수정
#### 수정 테스트 보완
<br/>

### 5.1.3 UserService.upgradeLevels()
#### UserService 클래스와 빈 등록
#### UserServiceTest 테스트 클래스
#### upgradeLevels() 메소드
#### upgradeLevels() 테스트
<br/>

### 5.1.4 UserService.add()
<br/>

### 5.1.5 코드 개선
#### upgradeLevels() 메소드 코드의 문제점
#### upgradeLevels() 리팩토링
#### User 테스트
#### UserServiceTest 개선
<br/>

## 5.2 트랜잭션 서비스 추상화

### 5.2.1 모 아니면 도
#### 테스트용 UserService 대역
#### 강제 예외 발생을 통한 테스트
#### 테스트 실패의 원인
<br/>

### 5.2.2 트랜잭션 경계설정
#### JDBC 트랜잭션의 트랜잭션 경계설정
#### UserService와 UserDao의 트랜잭션 문제
#### 비즈니스 로직 내의 트랜잭션 경계설정
#### UserService 트랜잭션 경계설정의 문제점
<br/>

### 5.2.3 트랜잭션 동기화
#### Connection 파라미터 제거
#### 트랜잭션 동기화 적용
#### 트랜잭션 테스트 보완
#### JdbcTemplate과 트랜잭션 동기화
<br/>

### 5.2.4 트랜잭션 서비스 추상화
#### 기술과 환경에 종속되는 트랜잭션 경계설정 코드
#### 트랜잭션 API의 의존관계 문제와 해결책
#### 스프링의 트랜잭션 서비스 추상화
#### 트랜잭션 기술 설정의 분리
<br/>

## 5.3 서비스 추상화와 단일 책임 원칙
#### 수직, 수평 계층구조와 의존관계
#### 단일 책임 원칙
#### 단일 책임 원칙의 장점
<br/>

## 5.4 메일 서비스 추상화

### 5.4.1 JavaMail을 이용한 메일 발송 기능
#### JavaMail 메일 발송
<br/>

### 5.4.2 JavaMail이 포함된 코드의 테스트
<br/>

### 5.4.3 테스트를 위한 서비스 추상화
#### JavaMail을 이용한 테스트의 문제점
#### 메일 발송 기능 추상화
#### 테스트용 메일 발송 오브젝트
#### 테스트와 서비스 추상화
<br/>

### 5.4.4 테스트 대역
#### 의존 오브젝트의 변경을 통한 테스트 방법
#### 테스트 대역의 종류와 특징
#### 목 오브젝트를 이용한 테스트
<br/>
