# 데이터 중복의 문제점 (이상현상)

![예제테이블](https://github.com/taechacode/TIL/assets/63395751/35c5995b-cd47-4e62-809d-26bab7540cfc)
<br/>

- 위의 테이블에서는 dept_name과 office의 값들이 여러 레코드에 반복되어 나타난다.
- 이와 같이 데이터가 중복 저장되는 경우에는 데이터 변경에 의해 원하지 않던 결과를 낳을 수 있다. 이러한 현상을 `이상현상(anomaly)`이라고 한다.
- 이상현상은 데이터의 삽입, 삭제, 수정과정에서 발생할 수 있다.
<br/>

## 삽입 이상
- 예제 테이블에 '물리학과'의 office가 '300호' 레코드를 신규로 삽입하려고 한다.
- 그러나 최소한 한 학생이 물리학과에 소속되기 전에는 이러한 사실을 테이블에 삽입할 수 없다.
- 이는 학생이 결정되지 않으면 stu_id에 null 값을 삽입해야 하는데, stu_id가 이 테이블의 기본키이므로 여기에 null 값을 삽입할 수 없기 때문이다.
<br/>

- 만약 반드시 이 레코드를 삽입해야 한다면 가상의 학번을 임시로 생성해서 삽입하는 수밖에 없다.
- 이와 같이 어떠한 데이터를 저장하려고 할 때 저장할 수 없거나 원하지 않는 데이터를 삽입해야만 하는 현상을 `삽입 이상(insertion anomaly)`이라고 한다.
<br/>

## 삭제 이상
- 예제 테이블에 어떤 학생의 학적 변동으로 인해 학번이 '1292501'인 레코드를 삭제한다고 가정하자.
- 그러면 '전자공학과'의 office가 '308호'라는 사실도 같이 삭제된다.
- 만약 이 테이블에 '전자공학과'에 소속된 다른 학생의 정보가 남아 있다면 큰 문제가 없지만 이 학생이 '전자공학과'에 소속된 유일한 학생이라면 '전자공학과'에 관련된 학과정보는 더 이상 이 테이블에 유지될 수 없다.
- 이와 같이 하나의 사실을 삭제할 경우 삭제되지 말아야 할 정보까지 동시에 삭제되는 현상을 `삭제 이상(deletion anomaly)`이라고 한다.
<br/>

## 수정 이상
- 예제 테이블에서 '컴퓨터공학과'의 사무실이 '201호'에서 '211호'로 변경되었다고 가정하자.
- 그러면 이 테이블에 존재하는 모든 '컴퓨터공학과'의 학생들의 레코드에 대해서 office 필드값을 수정해야 한다.
- 만일 하나의 레코드라고 수정이 되지 않으면 '201호'와 '211호'라는 사실이 혼재하여 추후에 어떠한 사실이 정확한 것인지 파악하지 못할 수 있다.
- 이와 같이 중복된 정보의 일부만을 수정하여 `정보의 불일치(inconsistency)`가 발생하는 현상을 `수정 이상(update anomaly)`이라고 한다.
<br/>

## 해결 방안
- 이러한 이상현상 문제들을 해결하는 방법은 학생에 관한 정보와 학과에 관한 정보를 별도의 테이블로 구성하는 것이다.
- 아래는 예제 테이블을 student 테이블과 department 테이블로 분해한 결과를 보여준다.
- 여기서 student 테이블의 dept_id는 department 테이블을 참조하는 외래키가 된다.
<br/>

![분해한 student 테이블](https://github.com/taechacode/TIL/assets/63395751/d65c1435-d1ba-4d9b-a863-f36193c00cbf)
#### ↑ 분해한 student 테이블
<br/>

![분해한 department 테이블](https://github.com/taechacode/TIL/assets/63395751/60e75081-3334-4971-91fb-f000f3aea76f)
#### ↑ 분해한 department 테이블
<br/>

- **삽입 이상 문제 :** '물리학과'에 소속된 학생이 한 명도 없어도 department 테이블에 ('930', '물리학과', '300호')라는 레코드를 삽입할 수 있다. 따라서 삽입 이상이 발생하지 않는다.
- **삭제 이상 문제 :** stu_id가 '1292501'인 학생 정보를 삭제하려면 student 테이블에서만 해당 레코드를 삭제하면 된다. 따라서 department 테이블에 저장된 '전자공학과'에 대한 정보는 그대로 남아있으므로 앞서 보았던 삭제 이상이 발생하지 않는다.
- **수정 이상 문제 :** '컴퓨터공학과'의 사무실이 '201호'에서 '211호'로 변경되었다면 department 테이블의 '컴퓨터공학과'에 해당하는 하나의 레코드만을 변경하면 된다. 따라서 정보의 불일치가 발생할 가능성이 없으므로 수정 이상도 발생하지 않는다.
